name: Stochastic Auto Green

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  auto_commit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Probability Logic & Grass Planting
        run: |
              touch last_update.txt
              touch target_decision.txt

              CURRENT_DATE=$(date +%Y-%m-%d)
              CURRENT_HOUR=$(date +%H)
              DAY_OF_WEEK=$(date +%u)

              DECISION_DATA=$(cat target_decision.txt 2>/dev/null || echo "")
              DECISION_DATE=$(echo $DECISION_DATA | cut -d ' ' -f 1)

              if [ "$CURRENT_DATE" != "$DECISION_DATE" ]; then
                RANDOM_VAL=$((RANDOM % 100))
                COMMIT_TODAY=false
                
                if [ $DAY_OF_WEEK -le 5 ]; then
                  if [ $RANDOM_VAL -ge 5 ]; then COMMIT_TODAY=true; fi
                else
                  if [ $RANDOM_VAL -ge 60 ]; then COMMIT_TODAY=true; fi
                fi

                if [ "$COMMIT_TODAY" = true ]; then
                  TARGET_HOUR=$((RANDOM % 24))
                  echo "$CURRENT_DATE $TARGET_HOUR" > target_decision.txt
                else
                  echo "$CURRENT_DATE SKIP" > target_decision.txt
                fi
              fi

              DECISION_DATA=$(cat target_decision.txt)
              TARGET_HOUR=$(echo $DECISION_DATA | cut -d ' ' -f 2)

              if [ "$TARGET_HOUR" != "SKIP" ] && [ $((10#$CURRENT_HOUR)) -eq $((10#$TARGET_HOUR)) ]; then
                git config --local user.email "ë³¸ì¸ì˜_ê¹ƒí—ˆë¸Œ_ì´ë©”ì¼@example.com"
                git config --local user.name "ë³¸ì¸ì˜_ê¹ƒí—ˆë¸Œ_ìœ ì €ë„¤ìž„"
                
                echo "Planting grass at target hour: $TARGET_HOUR ðŸŒ¿"
                echo "Last contribution: $(date)" > last_update.txt
                
                git add last_update.txt target_decision.txt
                git commit -m "chore: contribution at $(date)"
                git push
              else
                if [ "$TARGET_HOUR" = "SKIP" ]; then
                  echo "No commit planned for today."
                else
                  echo "Waiting for target hour: $TARGET_HOUR (Current: $CURRENT_HOUR)"
                fi
              fi